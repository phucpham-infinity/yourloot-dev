import{r as m,d as ee,p as fe,f as te,c as se,j as ne,m as n,k as d,n as K,F as re,C as oe,b as pe,q as he,h as xe,l as we,i as be,s as Ne,e as ve,o as Ce,t as P,v as Q,V as Ee,w as J,a as ke,x as Se}from"./index-Dbnc-V7B.js";import{D as _e,C as ye,u as Ie}from"./index-MjPQ37gC.js";function Ue({onSuccess:g}){const a=m.useRef(null),k=()=>{var u;(u=a==null?void 0:a.current)==null||u.submit()},{email:L,userId:f}=ee(),{useEmailVerificationMutation:z,useResendEmailVerificationMutation:y}=fe(),{mutate:c}=y(f??""),[I,w]=m.useState(60),[V,A]=m.useState(!0),[S,M]=m.useState(!1),[j,O]=m.useState(!1),{t:p}=te(),{setAccessToken:h,setUserId:T}=se(),{postUserPlatformEvent:Y}=ne();m.useEffect(()=>{if(V){const u=setInterval(()=>{w(x=>x<=1?(A(!1),clearInterval(u),0):x-1)},1e3);return()=>clearInterval(u)}},[V]);const{mutate:q,isPending:B,isSuccess:F,error:v,data:i}=z();m.useEffect(()=>{var u,x,b,s;v&&(u=v.content)!=null&&u.message&&(M(!0),(s=a==null?void 0:a.current)==null||s.setError("code",n("span",{className:"text-red-500",children:((b=(x=v==null?void 0:v.content)==null?void 0:x.message)==null?void 0:b.split(".")[0])??"Oops! Attempt failed! Please try again ðŸ˜Š"})))},[v]);const o=()=>{g==null||g()},Z=()=>{c()};return m.useEffect(()=>{var u,x,b,s,R;F&&i&&(h((u=i==null?void 0:i.content)==null?void 0:u.token,(x=i==null?void 0:i.content)==null?void 0:x.refreshToken),T((b=i==null?void 0:i.content)==null?void 0:b.userId),Y({eventType:"signup",userId:(s=i==null?void 0:i.content)==null?void 0:s.userId,token:(R=i==null?void 0:i.content)==null?void 0:R.token}),o())},[F,i]),d("div",{className:K("relative flex flex-col items-start justify-center w-full gap-5 overflow-hidden"),children:[d("div",{className:"flex flex-col items-start gap-0 relative self-stretch w-full flex-[0_0_auto]",children:[n("div",{className:"relative self-stretch text-app-white text-[20px] leading-[24px]",children:p("auth.checkYourEmail","Check your email")}),n("div",{className:"relative w-full break-words text-[#9E90CF] text-[14px]",children:p("auth.codeSentMessage","We've sent a code to your email. It's valid for 111 seconds").replace("111",I.toLocaleString())})]}),d("div",{className:"w-full",children:[n(re,{gap:40,ref:a,onFocus:()=>{a.current.clearError("code")},fields:[{name:"code",type:"text",inputType:"text-number",label:p("auth.confirmationCode","Confirmation code:"),placeholder:p("auth.confirmationCodePlaceholder","YYYY"),colSpan:12,validators:{onSubmit:({value:u})=>u?null:(O(!0),d("span",{className:"text-red-500",children:[" ",p("auth.codeRequired","Code is required")]}))}}],onSubmit:u=>{f&&L&&q({userId:f,email:L,verificationCode:u.code})},defaultValues:{code:""}}),I==0&&d("div",{onClick:()=>{A(!0),w(60),Z()},className:K("text-[#6C6395] mt-2 text-left hover:opacity-50 text-[14px] w-full",{"!mt-6":S||j}),children:[p("auth.didntReceiveCode","Didn't receive code?")," ",d("span",{className:"underline cursor-pointer text-white",children:[" ",p("auth.resendInSeconds","Resend in 59 sec").replace("59","59")]})]})]}),n("div",{className:"w-full",children:n(oe,{isLoading:B,disabled:B,onClick:k,label:p("auth.continue","Continue")})})]})}const Pe="/assets/signup-EN-qBRnoLOz.png",Le="/assets/signup-RU-TN1LIWDE.png",Ve="/assets/signup-UZ-D5w7akSF.png",Ae="/assets/signup-m-EN-AO5smNWv.png",Te="/assets/signup-m-RU-BNuHUe9N.png",Be="/assets/signup-m-UZ-tvoKUQ2l.png",Fe=()=>Math.floor(Math.random()*9e9+1e9).toString(),X=()=>{var k;const a=((typeof navigator<"u"?((k=navigator==null?void 0:navigator.languages)==null?void 0:k[0])||(navigator==null?void 0:navigator.language):"en")??"en").split("-")[0].toLowerCase();return a==="en"||a==="ru"||a==="es"?a:a==="uz"?"yz":a==="kk"?"kz":a==="az"?"az":"en"};function Oe(){const g=pe(),a=Ce(),k=m.useRef(null),{ip:L}=he(),{isMobile:f}=xe(),{isTelegramMiniApp:z,launchParams:y}=we(),{t:c,i18n:I}=te(),w=m.useRef(null);console.log("getDefaultBrowserLang",navigator.languages,X());const{useRegisterV2Mutation:V,useGetProvidersTelegram:A}=be(),{providersTelegram:S,setUserId:M,setEmail:j,setPromoCode:O,promoCode:p,step:h,setStep:T,setProvidersTelegram:Y}=ee(),{refetch:q}=A(),{useGetBackofficeAffiliate:B,useGetBackofficeUtm:F}=Ne(),{mutate:v}=B(),{mutate:i}=F(),[o]=ve(),[Z,u]=m.useState(!1),[x,b]=m.useState(null),[s,R]=m.useState({isValidateEnglish:!1,isValidateLength:!1,isValidateUppercase:!1,isValidateNumber:!1}),{mutate:ae,isPending:D,data:l,error:U}=V();m.useEffect(()=>{var e;U&&a.error(((e=U==null?void 0:U.content)==null?void 0:e.message)??"Oops! Attempt failed! Please try again ðŸ˜Š",{position:"top-right"})},[U]);const ie=()=>{T(2)};m.useEffect(()=>{var e,t,r,C,_,N;(e=l==null?void 0:l.content)!=null&&e.userId&&(M((t=l==null?void 0:l.content)==null?void 0:t.userId),ie(),(r=l==null?void 0:l.content)!=null&&r.userId&&(o.get("stag")||o.get("tr_src")||o.get("tracking_link")||o.get("source_link")||o.get("visit_id")||o.get("sub")||o.get("sub_id1")||o.get("sub_id2"))&&v({userId:(C=l==null?void 0:l.content)==null?void 0:C.userId,trackingLink:o.get("tracking_link")??"",sourceLink:o.get("source_link")??window.location.href,visitId:o.get("visit_id")??"",sub:o.get("sub")??"",stag:o.get("sub_id1")??o.get("stag")??"",trSrc:o.get("sub_id2")??o.get("tr_src")??""}),(_=l==null?void 0:l.content)!=null&&_.userId&&o.get("utm_source")&&i({userId:(N=l==null?void 0:l.content)==null?void 0:N.userId,utmSource:o.get("utm_source")??"",utmCampaign:o.get("utm_campaign")??"",utmMedium:o.get("utm_medium")??"",utmContent:o.get("utm_content")??"",sourceLink:o.get("source_link")??window.location.href}))},[l]);const le=e=>{j(e==null?void 0:e.email),ae({username:e==null?void 0:e.email,email:e==null?void 0:e.email,password:e==null?void 0:e.password,firstName:"YourLootPlayer"+J(new Date),lastName:"YourLootPlayer"+J(new Date),phoneNumber:Fe()??"",language:X(),currency:"RUB",userIp:L??"",sourceLink:o.get("source_link")??window.location.href,promoCode:p??""})},W=((e,t)=>{const r={en:t?Ae:Pe,ru:t?Te:Le,yz:t?Be:Ve};return r[e]||r.en})(I.language,f),{setAccessToken:ce,isAuthenticated:$,setUserId:ue,setUser:de}=se(),me=async e=>{var t;console.log("registerTelegramuser",e);try{de({id:(e==null?void 0:e.id)??"",first_name:(e==null?void 0:e.first_name)??"",last_name:(e==null?void 0:e.last_name)??"",username:(e==null?void 0:e.username)??"",photo_url:(e==null?void 0:e.photo_url)??"",auth_date:(e==null?void 0:e.auth_date)??"",hash:(e==null?void 0:e.hash)??"",isTelegramAuthenticated:!0});const r=await q(),C=(r==null?void 0:r.data)||S;r!=null&&r.data&&Y(r.data);const _=`${((t=C==null?void 0:C.content)==null?void 0:t.telegramLoginPath)??""}&telegram=${Ie(e)}`,N=await ke.get(_,{withCredentials:!0}),E=N.data;if(ce(E.content.token,E.content.refreshToken??E.content.token),ue(E.content.userId),!N||N.status>=400){console.error("Telegram register failed",N==null?void 0:N.status,E),a.error(E&&E.message||"Telegram register failed",{position:"top-right"});return}}catch(r){a.error((r==null?void 0:r.message)||"Network error",{position:"top-right"})}},{postUserPlatformEvent:ge}=ne(),G=()=>{ge({eventType:"login"}),g("/")};m.useEffect(()=>{if($){const e=o.get("redirect");if(e)try{const t=new URL(e,window.location.origin),r=new URLSearchParams(window.location.search);r.delete("redirect"),r.forEach((C,_)=>{t.searchParams.set(_,C)}),g(t.pathname+t.search,{state:{from:"default"}})}catch(t){console.error("Invalid redirect URL:",t),G()}else G()}},[$]),m.useEffect(()=>{I.changeLanguage("ru")},[]);const H=()=>{var e;return d("div",{className:P("flex w-full h-full gap-6",f&&"gap-0 h-fit"),children:[d("div",{className:P("w-full h-full",!f&&h==1&&"w-[306px]"),children:[h===1&&d(Q,{children:[f&&d("div",{className:"relative w-full h-[126px] mb-6",children:[n("div",{className:"flex z-10 flex-col items-start gap-2 absolute top-1/2 left-[24px] -translate-y-1/2"}),n("img",{className:"absolute w-full rounded-[10px] md:hidden block h-[126px] mb-6",src:W})]}),d("div",{className:P("w-full overflow-y-hidden"),children:[n("div",{className:"relative w-full",children:n(re,{gap:16,ref:w,onFocus:()=>{w.current.clearError("email"),w.current.clearError("password")},fields:[{name:"email",type:"text",label:c("register.email"),placeholder:c("register.emailPlaceholder"),colSpan:12,validators:{onBlur:({value:t})=>{const r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t?r.test(t)?t.includes("@")?t.length>255?n("span",{className:"text-red-500",children:c("auth.emailMaxLength")}):null:n("span",{className:"text-red-500",children:c("auth.emailMustContainAt")}):n("span",{className:"text-red-500",children:c("register.invalidEmail")}):n("span",{className:"text-red-500",children:c("register.emailRequired")})}}},{name:"password",type:"text",label:c("register.password"),placeholder:c("register.passwordPlaceholder"),inputType:"password",colSpan:12,validators:{onChange:({value:t})=>{if(!t){b(null);return}const r={...s};r.isValidateEnglish=/^[A-Za-z0-9]+$/.test(t),r.isValidateLength=t.length>=8,r.isValidateNumber=/\d/.test(t),r.isValidateUppercase=/[A-Z]/.test(t)&&/[a-z]/.test(t),R(r),Object.values(r).every(Boolean)?(u(!1),b(null)):(b("Password doesn't meet all requirements."),u(!0))}},customError:x,renderDescription:t=>n("div",{className:"w-full text-right text-[#6b6294] text-[10px] font-bold",children:t}),dropdownMenu:n("div",{className:"w-fit",children:n(Ee,{isFocus:!0,isValidateEnglish:s==null?void 0:s.isValidateEnglish,isValidateLength:s==null?void 0:s.isValidateLength,isValidateUppercase:s==null?void 0:s.isValidateUppercase,isValidateNumber:s==null?void 0:s.isValidateNumber})})},{name:"code",type:"text",label:c("register.promoCode.title"),placeholder:c("register.promoCode.placeholder"),colSpan:12,styleItem:{marginTop:Z?"12px":"0"},validators:{onChange:({value:t})=>{O(t)}}}],onSubmit:le,defaultValues:{email:"",password:"",code:""}})}),n("div",{className:"w-full mt-6",children:n(oe,{ref:k,isLoading:D,onClick:()=>{var t;(t=w==null?void 0:w.current)==null||t.submit()},disabled:D||!(s!=null&&s.isValidateEnglish)||!(s!=null&&s.isValidateLength)||!(s!=null&&s.isValidateUppercase)||!(s!=null&&s.isValidateNumber),label:c("register.registerButton"),textAlign:"center"})}),n("div",{className:"flex flex-col w-full gap-2 mt-3 h-fit",children:n("div",{className:"flex items-center justify-start gap-2",children:d("div",{className:"text-[14px] font-medium text-[#9E90CF]",children:[c("register.signUpConfirm18Agree","By signing up, you confirm youâ€™re 18+ and agree to the"),n("a",{href:"/terms-and-conditions",className:"underline text-[#FFFFFF] ml-[5px] hover:opacity-80 transition-colors",children:c("register.termsAndConditions")})]})})})]}),d("div",{className:"w-full flex flex-col gap-6 mt-6",children:[d("div",{className:"text-[#6C6395] text-app-bold-12 flex items-center justify-center gap-2",children:[n("div",{className:"bg-[#2A2242] w-full h-[1px]"}),n("div",{className:"min-w-[80px] text-center",children:"or sign up via"}),n("div",{className:"bg-[#2A2242] w-full h-[1px]"})]}),n(ye,{isTelegramMiniApp:z,launchParams:y==null?void 0:y.tgWebAppData,registerTelegram:me,botName:((e=S==null?void 0:S.content)==null?void 0:e.telegramBotUsername)??""}),d("div",{className:"cursor-pointer flex-col text-center text-[#9E90CF] text-[14px] font-bold",children:[d("div",{children:[c("register.haveAccount")," "]}),d("span",{onClick:()=>{g("/auth/login")},className:"text-white cursor-pointer hover:underline",children:[c("register.loginHere")," "]})]})]})]}),h===2&&n(Ue,{onSuccess:()=>{g("/"),T(1)}})]}),h==1&&!f&&n(Q,{children:n("div",{css:Re,className:P("relative grow h-full shrink min-h-[647px] basis-0 self-stretch p-10 bg-black rounded-[20px] flex-col justify-end items-start inline-flex overflow-hidden"),children:n("img",{className:"absolute z-[1] w-full h-full bottom-0 left-0 right-0",src:W})})})]})};return f?H():n(_e,{isOpen:!0,title:c("register.registerButton"),content:H(),className:P("!w-full ",h===2?"max-w-[350px]!":"min-h-[695px]!"),dismissible:h!==2,hideCloseButton:h===2,onClose:()=>{h!==2&&g("/")}})}const Re=Se`
  width: 306px;
  border: 1px solid #3e3650;

  border-radius: 10px;
  box-shadow: 6px 6px 16px 0px rgba(22, 28, 22, 0.25);
  background: url('/images/register/yourloot-banner-register.png') no-repeat
    center center;
  background-size: cover;
`;export{Oe as default};
//# sourceMappingURL=index-CRxLyrbH.js.map
