{"version":3,"file":"login-BLpBfGv1.js","sources":["../../src/services/controller/auth/index.tsx","../../public/images/v2/banner-auth/login-UZ.png","../../public/images/v2/banner-auth/login-RU.png","../../public/images/v2/banner-auth/login-EN.png","../../src/app/v2/auth/login/login.tsx"],"sourcesContent":["import { useMutation } from '@tanstack/react-query'\nimport { httpClient } from '@/services/api'\n\nexport interface LoginRequest {\n  username: string\n  password: string\n}\n\nexport interface LoginResponse {\n  token: string\n  refreshToken: string\n  userId: string\n}\n\nexport interface BaseResponseLoginResponse {\n  traceId: string\n  timestamp: string\n  contentType: string\n  content: LoginResponse\n}\n\nexport interface LogoutRequest {\n  userId: string\n  refreshToken: string\n}\n\nexport interface LogoutAllRequest {\n  userId: string\n}\n\nexport const authController = () => {\n  const useLoginMutation = () =>\n    useMutation<BaseResponseLoginResponse, Error, LoginRequest>({\n      mutationFn: async (\n        data: LoginRequest\n      ): Promise<BaseResponseLoginResponse> => {\n        const response = await httpClient.post('/auth/login', data)\n        return response.data\n      }\n    })\n\n  const useLogoutMutation = () =>\n    useMutation<BaseResponseLoginResponse, Error, LogoutRequest>({\n      mutationFn: async (\n        data: LogoutRequest\n      ): Promise<BaseResponseLoginResponse> => {\n        const response = await httpClient.post('/auth/logout/current', data)\n        return response.data\n      }\n    })\n\n  const useLogoutAllMutation = () =>\n    useMutation<BaseResponseLoginResponse, Error, LogoutAllRequest>({\n      mutationFn: async (\n        data: LogoutAllRequest\n      ): Promise<BaseResponseLoginResponse> => {\n          const response = await httpClient.post('/auth/logout/all', data)\n          return response.data\n        }\n      })\n\n\n  return {\n    useLoginMutation,\n    useLogoutMutation,\n    useLogoutAllMutation\n  }\n}\n","export default \"__VITE_ASSET__DF9GrnXm__\"","export default \"__VITE_ASSET__CGXirobz__\"","export default \"__VITE_ASSET__BOEYlxIG__\"","import { useEffect, useRef, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { useNavigate, useSearchParams } from 'react-router-dom'\n\nimport CustomButton from '@/components/common/custom-button'\n\nimport { FormBuilder } from '@/components/common/form-builder'\nimport {\n  useUserPlatformEvent,\n  useScreen,\n  useToast,\n  useTelegramMiniApp\n} from '@/hooks'\nimport { authController, registrationController } from '@/services/controller'\nimport { useAuthStore, useRegisterStore } from '@/store'\nimport clsx from 'clsx'\n// import authLogin from '/public/images/v2/auth/auth-login.png'\n\nimport banner_UZ from '/public/images/v2/banner-auth/login-UZ.png'\nimport banner_RU from '/public/images/v2/banner-auth/login-RU.png'\nimport banner_EN from '/public/images/v2/banner-auth/login-EN.png'\nimport { utf8ToBase64 } from '@/lib/tele-widget'\nimport { httpClient } from '@/services/api'\nimport CustomTelegramLogin from '../CustomTelegramLogin'\nimport { DialogAuth } from '@/app/v2/auth/dialog-auth'\n\nexport default function SignInV2() {\n  const navigate = useNavigate()\n  const buttonRef = useRef<HTMLButtonElement>(null)\n  const formRef = useRef<any>(null)\n  const { setAccessToken, isAuthenticated, setUserId, setUser } = useAuthStore()\n  const { providersTelegram, setStep, setProvidersTelegram } =\n    useRegisterStore()\n  const [searchParams] = useSearchParams()\n  const { t, i18n } = useTranslation()\n  const toast = useToast()\n\n  const { useLoginMutation } = authController()\n  const { isMobile } = useScreen()\n  const [isShowError, setIsShowError] = useState(false)\n\n  const { useGetProvidersTelegram } = registrationController()\n  const { refetch: refetchProviders } = useGetProvidersTelegram()\n\n  const { postUserPlatformEvent } = useUserPlatformEvent()\n\n  const getBanner = (language: string) => {\n    const banners = {\n      en: banner_EN,\n      ru: banner_RU,\n      yz: banner_UZ\n    }\n\n    return banners[language as keyof typeof banners] || banners['en']\n  }\n\n  const authLogin = getBanner(i18n.language)\n\n  const {\n    mutate: login,\n    isPending: isPendingLogin,\n    data: dataLogin,\n    error: errorLogin\n  } = useLoginMutation()\n\n  const handleSubmitLogin = (data: any) => {\n    if (data?.username) {\n      localStorage.setItem('email', data.username)\n    }\n    login({\n      username: data.username,\n      password: data.password\n    })\n  }\n\n  useEffect(() => {\n    if (dataLogin) {\n      setAccessToken(\n        dataLogin.content.token,\n        dataLogin.content.refreshToken ?? dataLogin.content.token\n      )\n      setUserId(dataLogin.content.userId)\n    }\n  }, [dataLogin])\n\n  useEffect(() => {\n    if (errorLogin) {\n      setIsShowError(true)\n      formRef.current?.setError(\n        'password',\n        <span className=\"text-red-500 italic\">\n          {t('login.wrongPassword', 'Invalid email or password')}{' '}\n        </span>\n      )\n    }\n  }, [errorLogin])\n\n  const { isTelegramMiniApp, launchParams } = useTelegramMiniApp()\n  console.log('launchParams', launchParams)\n\n  const registerTelegram = async (user: any) => {\n    console.log('loginTelegramuser', user)\n    try {\n      setUser({\n        first_name: user?.first_name,\n        last_name: user?.last_name,\n        username: user.username,\n        photo_url: user?.photo_url,\n        auth_date: user?.auth_date,\n        hash: user?.hash,\n        isTelegramAuthenticated: true\n      })\n\n      const latest = await refetchProviders()\n      const latestProviders = latest?.data || providersTelegram\n      if (latest?.data) setProvidersTelegram(latest.data)\n\n      const url = `${\n        latestProviders?.content?.telegramLoginPath ?? ''\n      }&telegram=${utf8ToBase64(user)}`\n\n      const res = await httpClient.get(url, { withCredentials: true })\n\n      const payload = res.data\n\n      setAccessToken(\n        payload.content.token,\n        payload.content.refreshToken ?? payload.content.token\n      )\n\n      setUserId(payload.content.userId)\n\n      if (!res || res.status >= 400) {\n        console.error('Telegram register failed', res?.status, payload)\n        toast.error(\n          (payload && payload.message) || 'Telegram register failed',\n          { position: 'top-right' }\n        )\n        return\n      }\n\n      // toast.success('Telegram register success', { position: 'top-right' })\n    } catch (e: any) {\n      toast.error(e?.message || 'Network error', { position: 'top-right' })\n    }\n  }\n\n  const handleLoginSuccess = () => {\n    postUserPlatformEvent({ eventType: 'login' })\n    navigate('/')\n  }\n\n  useEffect(() => {\n    if (isAuthenticated) {\n      const redirectParam = searchParams.get('redirect')\n      if (redirectParam) {\n        try {\n          const redirectUrl = new URL(redirectParam, window.location.origin)\n          const currentParams = new URLSearchParams(window.location.search)\n          currentParams.delete('redirect')\n\n          currentParams.forEach((value, key) => {\n            redirectUrl.searchParams.set(key, value)\n          })\n\n          navigate(redirectUrl.pathname + redirectUrl.search, {\n            state: { from: 'default' }\n          })\n        } catch (error) {\n          console.error('Invalid redirect URL:', error)\n          handleLoginSuccess()\n        }\n      } else {\n        handleLoginSuccess()\n      }\n    }\n  }, [isAuthenticated])\n\n  const renderContent = () => (\n    <div className=\"w-full flex flex-col justify-start items-start\">\n      <div className=\"w-full relative\">\n        <FormBuilder\n          gap={20}\n          ref={formRef}\n          onFocus={() => {\n            formRef.current.clearError('username')\n          }}\n          fields={[\n            {\n              name: 'username',\n              type: 'text',\n              label: t('login.email', 'Email'),\n              placeholder: t('login.emailPlaceholder', 'example@example.com'),\n              colSpan: 12,\n              validators: {\n                onBlur: ({ value }: any) => {\n                  if (!value) {\n                    return (\n                      <span className=\"text-red-500\">\n                        {t('auth.emailRequired', 'Email is required')}\n                      </span>\n                    )\n                  }\n                  if (!value.includes('@')) {\n                    return (\n                      <span className=\"text-red-500\">\n                        {t('auth.emailMustContainAt')}\n                      </span>\n                    )\n                  }\n                  if (value.length > 255) {\n                    return (\n                      <span className=\"text-red-500\">\n                        {t('auth.emailMaxLength')}\n                      </span>\n                    )\n                  }\n                  return null\n                }\n              }\n            },\n            {\n              name: 'password',\n              type: 'text',\n              label: t('login.password'),\n              placeholder: t('login.passwordPlaceholder'),\n              inputType: 'password',\n              colSpan: 12,\n              validators: {}\n            }\n          ]}\n          onSubmit={handleSubmitLogin}\n          defaultValues={{\n            username: localStorage.getItem('email') || '',\n            password: ''\n          }}\n        />\n      </div>\n\n      <div className=\"w-full mt-4 flex flex-col gap-6 overflow-x-hidden\">\n        <div\n          onClick={() => {\n            navigate('/auth/forgot-password')\n          }}\n          className=\"text-white text-app-medium-14 cursor-pointer hover:underline\"\n        >\n          Reset Password\n        </div>\n\n        <CustomButton\n          ref={buttonRef}\n          onClick={() => {\n            formRef.current?.clearError('password')\n            setIsShowError(false)\n            formRef.current?.submit()\n          }}\n          className={clsx({ 'mt-5': isShowError })}\n          isLoading={isPendingLogin}\n          disabled={isPendingLogin}\n          label={t('login.loginButton')}\n          textAlign=\"center\"\n        />\n\n        <div className=\"text-[#6C6395] text-app-bold-12 flex items-center justify-center gap-2\">\n          <div className=\"bg-[#2A2242] w-full h-[1px]\"></div>\n          <div className=\"min-w-[70px] text-center\">or log in via</div>\n          <div className=\"bg-[#2A2242] w-full h-[1px]\"></div>\n        </div>\n\n        <CustomTelegramLogin\n          isTelegramMiniApp={isTelegramMiniApp}\n          launchParams={launchParams?.tgWebAppData}\n          registerTelegram={registerTelegram}\n          botName={providersTelegram?.content?.telegramBotUsername ?? ''}\n        />\n\n        <div className=\"cursor-pointer flex-col text-center text-[#9E90CF] text-[14px] font-bold\">\n          <div>{t('login.noAccount')} </div>\n          <span\n            onClick={() => {\n              navigate('/auth/register')\n              setStep(1)\n            }}\n            className=\"text-white cursor-pointer hover:underline\"\n          >\n            {' '}\n            {t('login.registerHere')}{' '}\n          </span>\n        </div>\n      </div>\n      <img\n        src={authLogin}\n        alt=\"auth-login\"\n        className=\"w-full h-[126px] rounded-[10px] mt-[24px]\"\n      />\n    </div>\n  )\n\n  if (!isMobile)\n    return (\n      <DialogAuth\n        isOpen={true}\n        title={t('login.loginButton')}\n        content={renderContent()}\n        className=\"!w-[410px]\"\n        onClose={() => {\n          navigate('/')\n        }}\n      />\n    )\n\n  return renderContent()\n}\n"],"names":["authController","useMutation","data","httpClient","banner_UZ","banner_RU","banner_EN","SignInV2","navigate","useNavigate","buttonRef","useRef","formRef","setAccessToken","isAuthenticated","setUserId","setUser","useAuthStore","providersTelegram","setStep","setProvidersTelegram","useRegisterStore","searchParams","useSearchParams","t","i18n","useTranslation","toast","useToast","useLoginMutation","isMobile","useScreen","isShowError","setIsShowError","useState","useGetProvidersTelegram","registrationController","refetchProviders","postUserPlatformEvent","useUserPlatformEvent","authLogin","language","banners","login","isPendingLogin","dataLogin","errorLogin","handleSubmitLogin","useEffect","_a","jsxs","isTelegramMiniApp","launchParams","useTelegramMiniApp","registerTelegram","user","latest","latestProviders","url","utf8ToBase64","res","payload","e","handleLoginSuccess","redirectParam","redirectUrl","currentParams","value","key","error","renderContent","jsx","FormBuilder","CustomButton","_b","clsx","CustomTelegramLogin","DialogAuth"],"mappings":"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"}