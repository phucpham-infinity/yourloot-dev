import{u as N,a as w,b as Z,r as d,c as $,d as G,e as O,f as W,h as J,i as K,j as Q,k as i,l as X,m as a,F as Y,n as ee,C as te,o as ne}from"./index-Dbnc-V7B.js";import{D as ae,C as se,u as oe}from"./index-MjPQ37gC.js";const re=()=>({useLoginMutation:()=>N({mutationFn:async o=>(await w.post("/auth/login",o)).data}),useLogoutMutation:()=>N({mutationFn:async o=>(await w.post("/auth/logout/current",o)).data}),useLogoutAllMutation:()=>N({mutationFn:async o=>(await w.post("/auth/logout/all",o)).data})}),ie="/assets/login-UZ-CFDyHlRs.png",le="/assets/login-RU-DN3gdjc8.png",ce="/assets/login-EN-CNzi_IAs.png";function ge(){const l=Z(),v=d.useRef(null),c=d.useRef(null),{setAccessToken:o,isAuthenticated:g,setUserId:b,setUser:A}=$(),{providersTelegram:h,setStep:y,setProvidersTelegram:M}=G(),[R]=O(),{t:s,i18n:U}=W(),L=ne(),{useLoginMutation:k}=re(),{isMobile:_}=J(),[I,P]=d.useState(!1),{useGetProvidersTelegram:B}=K(),{refetch:F}=B(),{postUserPlatformEvent:j}=Q(),D=(e=>{const t={en:ce,ru:le,yz:ie};return t[e]||t.en})(U.language),{mutate:q,isPending:C,data:u,error:E}=k(),z=e=>{e!=null&&e.username&&localStorage.setItem("email",e.username),q({username:e.username,password:e.password})};d.useEffect(()=>{u&&(o(u.content.token,u.content.refreshToken??u.content.token),b(u.content.userId))},[u]),d.useEffect(()=>{var e;E&&(P(!0),(e=c.current)==null||e.setError("password",i("span",{className:"text-red-500 italic",children:[s("login.wrongPassword","Invalid email or password")," "]})))},[E]);const{isTelegramMiniApp:H,launchParams:f}=X();console.log("launchParams",f);const V=async e=>{var t;console.log("loginTelegramuser",e);try{A({first_name:e==null?void 0:e.first_name,last_name:e==null?void 0:e.last_name,username:e.username,photo_url:e==null?void 0:e.photo_url,auth_date:e==null?void 0:e.auth_date,hash:e==null?void 0:e.hash,isTelegramAuthenticated:!0});const n=await F(),p=(n==null?void 0:n.data)||h;n!=null&&n.data&&M(n.data);const x=`${((t=p==null?void 0:p.content)==null?void 0:t.telegramLoginPath)??""}&telegram=${oe(e)}`,m=await w.get(x,{withCredentials:!0}),r=m.data;if(o(r.content.token,r.content.refreshToken??r.content.token),b(r.content.userId),!m||m.status>=400){console.error("Telegram register failed",m==null?void 0:m.status,r),L.error(r&&r.message||"Telegram register failed",{position:"top-right"});return}}catch(n){L.error((n==null?void 0:n.message)||"Network error",{position:"top-right"})}},S=()=>{j({eventType:"login"}),l("/")};d.useEffect(()=>{if(g){const e=R.get("redirect");if(e)try{const t=new URL(e,window.location.origin),n=new URLSearchParams(window.location.search);n.delete("redirect"),n.forEach((p,x)=>{t.searchParams.set(x,p)}),l(t.pathname+t.search,{state:{from:"default"}})}catch(t){console.error("Invalid redirect URL:",t),S()}else S()}},[g]);const T=()=>{var e;return i("div",{className:"w-full flex flex-col justify-start items-start",children:[a("div",{className:"w-full relative",children:a(Y,{gap:20,ref:c,onFocus:()=>{c.current.clearError("username")},fields:[{name:"username",type:"text",label:s("login.email","Email"),placeholder:s("login.emailPlaceholder","example@example.com"),colSpan:12,validators:{onBlur:({value:t})=>t?t.includes("@")?t.length>255?a("span",{className:"text-red-500",children:s("auth.emailMaxLength")}):null:a("span",{className:"text-red-500",children:s("auth.emailMustContainAt")}):a("span",{className:"text-red-500",children:s("auth.emailRequired","Email is required")})}},{name:"password",type:"text",label:s("login.password"),placeholder:s("login.passwordPlaceholder"),inputType:"password",colSpan:12,validators:{}}],onSubmit:z,defaultValues:{username:localStorage.getItem("email")||"",password:""}})}),i("div",{className:"w-full mt-4 flex flex-col gap-6 overflow-x-hidden",children:[a("div",{onClick:()=>{l("/auth/forgot-password")},className:"text-white text-app-medium-14 cursor-pointer hover:underline",children:"Reset Password"}),a(te,{ref:v,onClick:()=>{var t,n;(t=c.current)==null||t.clearError("password"),P(!1),(n=c.current)==null||n.submit()},className:ee({"mt-5":I}),isLoading:C,disabled:C,label:s("login.loginButton"),textAlign:"center"}),i("div",{className:"text-[#6C6395] text-app-bold-12 flex items-center justify-center gap-2",children:[a("div",{className:"bg-[#2A2242] w-full h-[1px]"}),a("div",{className:"min-w-[70px] text-center",children:"or log in via"}),a("div",{className:"bg-[#2A2242] w-full h-[1px]"})]}),a(se,{isTelegramMiniApp:H,launchParams:f==null?void 0:f.tgWebAppData,registerTelegram:V,botName:((e=h==null?void 0:h.content)==null?void 0:e.telegramBotUsername)??""}),i("div",{className:"cursor-pointer flex-col text-center text-[#9E90CF] text-[14px] font-bold",children:[i("div",{children:[s("login.noAccount")," "]}),i("span",{onClick:()=>{l("/auth/register"),y(1)},className:"text-white cursor-pointer hover:underline",children:[" ",s("login.registerHere")," "]})]})]}),a("img",{src:D,alt:"auth-login",className:"w-full h-[126px] rounded-[10px] mt-[24px]"})]})};return _?T():a(ae,{isOpen:!0,title:s("login.loginButton"),content:T(),className:"!w-[410px]",onClose:()=>{l("/")}})}export{ge as default};
//# sourceMappingURL=login-BLpBfGv1.js.map
